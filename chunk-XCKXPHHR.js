import{c as z,e as K,k as L,l as B,m as U,q as V}from"./chunk-NSBI3P67.js";import{b as R,d as O}from"./chunk-7F5TGI7W.js";import{c as $}from"./chunk-HTPDR6PX.js";import"./chunk-UCXKB2AN.js";import{Aa as D,Fb as q,Ja as I,Ma as k,N as y,Na as f,Oa as E,Pa as P,Qa as t,Ra as e,Sa as g,Ya as b,aa as h,ca as F,db as i,eb as N,fb as o,hb as T,ib as C,jb as w,kb as j,pa as a,pb as A}from"./chunk-OIFITK5Y.js";var Y=()=>[1,2,3,4],G=(p,u)=>u.key;function H(p,u){p&1&&(t(0,"td"),i(1,"1"),e(),t(2,"td"),i(3,"2"),e(),t(4,"td"),i(5,"3"),e(),t(6,"td"),i(7,"4"),e(),t(8,"td"),i(9,"5"),e())}function Q(p,u){if(p&1&&(t(0,"tr")(1,"td"),i(2),e(),t(3,"td"),i(4),e(),t(5,"td"),i(6),e(),t(7,"td"),i(8),e(),t(9,"td"),i(10),e(),t(11,"td"),i(12),e(),t(13,"td"),i(14),e(),t(15,"td"),i(16),e(),t(17,"td"),i(18),e(),t(19,"td"),i(20),e(),t(21,"td"),i(22),e(),t(23,"td"),i(24),e(),t(25,"td"),i(26),e(),t(27,"td"),i(28),e(),t(29,"td"),i(30),e(),t(31,"td"),i(32),e(),t(33,"td"),i(34),e(),t(35,"td"),i(36),e(),t(37,"td"),i(38),e(),t(39,"td"),i(40),e(),t(41,"td"),i(42),e()()),p&2){let n=u.$implicit;I("class",n.key),a(2),o(" ",n.key==="lunch"?"Pranzo":n.key==="dinner"?"Cena":"N.D."," "),a(2),o("",n.value.foodPercentage[1],"%"),a(2),o("",n.value.foodPercentage[2],"%"),a(2),o("",n.value.foodPercentage[3],"%"),a(2),o("",n.value.foodPercentage[4],"%"),a(2),o("",n.value.foodPercentage[5],"%"),a(2),o("",n.value.servicePercentage[1],"%"),a(2),o("",n.value.servicePercentage[2],"%"),a(2),o("",n.value.servicePercentage[3],"%"),a(2),o("",n.value.servicePercentage[4],"%"),a(2),o("",n.value.servicePercentage[5],"%"),a(2),o("",n.value.locationPercentage[1],"%"),a(2),o("",n.value.locationPercentage[2],"%"),a(2),o("",n.value.locationPercentage[3],"%"),a(2),o("",n.value.locationPercentage[4],"%"),a(2),o("",n.value.locationPercentage[5],"%"),a(2),o("",n.value.hospitalityPercentage[1],"%"),a(2),o("",n.value.hospitalityPercentage[2],"%"),a(2),o("",n.value.hospitalityPercentage[3],"%"),a(2),o("",n.value.hospitalityPercentage[4],"%"),a(2),o("",n.value.hospitalityPercentage[5],"%")}}function J(p,u){if(p&1&&(t(0,"div",19)(1,"h3"),i(2),e(),t(3,"table")(4,"tr"),g(5,"th"),t(6,"th",20),i(7,"Cibo"),e(),t(8,"th",20),i(9,"Servizio"),e(),t(10,"th",20),i(11,"Location"),e(),t(12,"th",20),i(13,"Accoglienza"),e()(),t(14,"tr"),g(15,"td"),f(16,H,10,0,null,null,k),e(),f(18,Q,43,22,"tr",null,G),C(20,"keyvalue"),e()()),p&2){let n=u.$implicit;a(2),N(n.key),a(14),E(T(3,Y)),a(2),E(w(20,1,n.value))}}var ce=(()=>{class p{#e;#t;#i;constructor(){this.total=h(0),this.totalClients=h(0),this.totalFriends=h(0),this.totalSocial=h(0),this.percentageClients=h(""),this.percentageFriends=h(""),this.percentageSocial=h(""),this.statisticDays=h({}),this.#e=y(q),this.#t=y(R),this.#i=y(O),this.year=h(""),this.month=h(""),this.jsonResource=A({params:()=>({year:this.year(),month:this.month()}),loader:async({params:{year:r,month:s}})=>{if(!(!r||!s))return this.#e.loadStatisticsFromLocal?this.#e.filterPostcards(+r,+s):(await fetch(`assets/data/${r}/${s.toString().padStart(2,"0")}.json`)).json()}});let n=this.#t.snapshot.queryParams;if(n.year&&n.month){let r=n.year.toString(),s=n.month.toString().padStart(2,"0");this.year.set(r),this.month.set(s)}F(()=>{let r=this.jsonResource.value();!r||this.jsonResource.isLoading()||this.#o(r)})}onSelectMonthChange(n){this.month.set(n),this.#n(),this.#a()}onSelectYearChange(n){this.year.set(n),this.#n(),this.#a()}#n(){let n=this.year(),r=this.month();n&&r?this.#i.navigate([],{relativeTo:this.#t,queryParams:{year:n,month:r},queryParamsHandling:"merge"}):this.#i.navigate([],{relativeTo:this.#t,queryParams:{}})}#a(){this.total.set(0),this.totalClients.set(0),this.totalFriends.set(0),this.totalSocial.set(0),this.percentageClients.set(""),this.percentageFriends.set(""),this.percentageSocial.set(""),this.statisticDays.set({})}#o(n){for(let r in n){let s=n[r];for(let v in s){let x=s[v];for(let M in x){let _=x[M],c={lunch:{food:{1:0,2:0,3:0,4:0,5:0},foodPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},service:{1:0,2:0,3:0,4:0,5:0},servicePercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},location:{1:0,2:0,3:0,4:0,5:0},locationPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},hospitality:{1:0,2:0,3:0,4:0,5:0},hospitalityPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"}},dinner:{food:{1:0,2:0,3:0,4:0,5:0},foodPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},service:{1:0,2:0,3:0,4:0,5:0},servicePercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},location:{1:0,2:0,3:0,4:0,5:0},locationPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},hospitality:{1:0,2:0,3:0,4:0,5:0},hospitalityPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"}},unknown:{food:{1:0,2:0,3:0,4:0,5:0},foodPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},service:{1:0,2:0,3:0,4:0,5:0},servicePercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},location:{1:0,2:0,3:0,4:0,5:0},locationPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"},hospitality:{1:0,2:0,3:0,4:0,5:0},hospitalityPercentage:{1:"0.0",2:"0.0",3:"0.0",4:"0.0",5:"0.0"}}};for(let l in _){let S=_[l];this.total.update(d=>d+(S?.length??0));for(let d of S??[])d.howKnowUs==="client"?this.totalClients.update(m=>m+1):d.howKnowUs==="friend"?this.totalFriends.update(m=>m+1):d.howKnowUs==="social"&&this.totalSocial.update(m=>m+1),c[l].food[d.food]++,c[l].service[d.service]++,c[l].location[d.location]++,c[l].hospitality[d.hospitality]++;for(let d in c[l].food){let m=+d;c[l].foodPercentage[m]=(c[l].food[m]/(S?.length??0)*100).toFixed(1)}for(let d in c[l].service){let m=+d;c[l].servicePercentage[m]=(c[l].service[m]/(S?.length??0)*100).toFixed(1)}for(let d in c[l].location){let m=+d;c[l].locationPercentage[m]=(c[l].location[m]/(S?.length??0)*100).toFixed(1)}for(let d in c[l].hospitality){let m=+d;c[l].hospitalityPercentage[m]=(c[l].hospitality[m]/(S?.length??0)*100).toFixed(1)}}this.statisticDays.update(l=>(l[`${M}/${v}/${r}`]=c,l))}this.percentageClients.set((this.totalClients()/this.total()*100).toFixed(1)),this.percentageFriends.set((this.totalFriends()/this.total()*100).toFixed(1)),this.percentageSocial.set((this.totalSocial()/this.total()*100).toFixed(1))}}}deleteCurrentMonth(){let n=this.year(),r=this.month();!n||!r||(this.#e.deleteMonth(+n,+r),this.jsonResource.reload())}valueAscOrder(n,r){return+n.key>+r.key?1:+r.key>+n.key?-1:0}static{this.\u0275fac=function(r){return new(r||p)}}static{this.\u0275cmp=D({type:p,selectors:[["app-statistics"]],decls:72,vars:9,consts:[[1,"statistics-filters","no-print"],[3,"ngModelChange","ngModel"],["value",""],["value","01"],["value","02"],["value","03"],["value","04"],["value","05"],["value","06"],["value","07"],["value","08"],["value","09"],["value","10"],["value","11"],["value","12"],["value","2023"],["value","2024"],[3,"click"],[1,"info"],[1,"day-statistic"],["colspan","5"]],template:function(r,s){r&1&&(t(0,"div",0)(1,"label")(2,"span"),i(3,"Mese "),e(),t(4,"select",1),b("ngModelChange",function(x){return s.onSelectMonthChange(x)}),t(5,"option",2),i(6,"-"),e(),t(7,"option",3),i(8,"Gennaio"),e(),t(9,"option",4),i(10,"Febbraio"),e(),t(11,"option",5),i(12,"Marzo"),e(),t(13,"option",6),i(14,"Aprile"),e(),t(15,"option",7),i(16,"Maggio"),e(),t(17,"option",8),i(18,"Giugno"),e(),t(19,"option",9),i(20,"Luglio"),e(),t(21,"option",10),i(22,"Agosto"),e(),t(23,"option",11),i(24,"Settembre"),e(),t(25,"option",12),i(26,"Ottobre"),e(),t(27,"option",13),i(28,"Novembre"),e(),t(29,"option",14),i(30,"Dicembre"),e()()(),t(31,"span"),i(32," / "),e(),t(33,"label")(34,"span"),i(35,"Anno "),e(),t(36,"select",1),b("ngModelChange",function(x){return s.onSelectYearChange(x)}),t(37,"option",2),i(38,"-"),e(),t(39,"option",15),i(40,"2023"),e(),t(41,"option",16),i(42,"2024"),e()()(),t(43,"button",17),b("click",function(){return s.deleteCurrentMonth()}),i(44,"Elimina mese corrente"),e()(),t(45,"p",18)(46,"span")(47,"b"),i(48,"Totale cartoline:"),e(),i(49),e(),g(50,"br"),t(51,"span")(52,"b"),i(53,"Come ci hai conosciuto?"),e(),g(54,"br"),t(55,"span")(56,"b"),i(57,"Facebook:"),e(),i(58),e(),g(59,"br"),t(60,"span")(61,"b"),i(62,"Passaparola:"),e(),i(63),e(),g(64,"br"),t(65,"span")(66,"b"),i(67,"Cliente da tempo:"),e(),i(68),e()()(),f(69,J,21,4,"div",19,G),C(71,"keyvalue")),r&2&&(a(4),P("ngModel",s.month()),a(32),P("ngModel",s.year()),a(13),o(" ",s.total()),a(9),o(" ",s.percentageSocial(),"%"),a(5),o(" ",s.percentageFriends(),"%"),a(5),o(" ",s.percentageClients(),"%"),a(),E(j(71,6,s.statisticDays(),s.valueAscOrder)))},dependencies:[V,B,U,L,z,K,$],styles:[`app-statistics{display:block}app-statistics .statistics-filters{background:var(--card-background);border-radius:8px;box-shadow:0 2px 4px var(--shadow-color);padding:1.5rem;text-align:center}app-statistics .info{height:185px;display:flex;justify-content:center;flex-direction:column}app-statistics .day-statistic{height:195px}app-statistics th{border-top:1px solid}app-statistics td{width:61.5px}app-statistics th,app-statistics td{text-align:center;border-right:1px solid;border-bottom:1px solid}app-statistics .lunch{background-color:#fce5cd!important;color:#000}app-statistics .dinner{background-color:#d9ead3!important;color:#000}app-statistics .unknown{background-color:#d9d2e9!important;color:#000}
`],encapsulation:2,changeDetection:0})}}return p})();export{ce as StatisticsComponent};
